# PDF Validator Service Makefile

.PHONY: help up down restart logs build clean status

# é»˜è®¤ç›®æ ‡
help:
	@echo "PDF Validator Service - å¯ç”¨å‘½ä»¤:"
	@echo ""
	@echo "  make up          - å¯åŠ¨æ‰€æœ‰æœåŠ¡"
	@echo "  make down        - åœæ­¢æ‰€æœ‰æœåŠ¡"
	@echo "  make restart     - é‡å¯æ‰€æœ‰æœåŠ¡"
	@echo "  make logs        - æŸ¥çœ‹æœåŠ¡æ—¥å¿—"
	@echo "  make build       - é‡æ–°æ„å»ºé•œåƒ"
	@echo "  make clean       - æ¸…ç†æ‰€æœ‰å®¹å™¨å’Œå·"
	@echo "  make status      - æŸ¥çœ‹æœåŠ¡çŠ¶æ€"
	@echo "  make test        - æµ‹è¯•PDFéªŒè¯API"
	@echo ""
	@echo "å•ä¸ªæœåŠ¡æ“ä½œ:"
	@echo "  make api-logs    - æŸ¥çœ‹APIæœåŠ¡æ—¥å¿—"
	@echo "  make worker-logs - æŸ¥çœ‹Workeræ—¥å¿—"
	@echo "  make flower      - æ‰“å¼€Flowerç›‘æ§ç•Œé¢"

# å¯åŠ¨æœåŠ¡
up:
	@echo "ğŸš€ å¯åŠ¨PDF ValidatoræœåŠ¡..."
	docker-compose up -d
	@echo "âœ… æœåŠ¡å·²å¯åŠ¨"
	@echo ""
	@echo "ğŸ“ æœåŠ¡åœ°å€:"
	@echo "  - API: http://localhost:8001"
	@echo "  - Flower: http://localhost:5555"
	@echo "  - MinIO: http://localhost:9001"

# åœæ­¢æœåŠ¡
down:
	@echo "â¹ï¸ åœæ­¢PDF ValidatoræœåŠ¡..."
	docker-compose down
	@echo "âœ… æœåŠ¡å·²åœæ­¢"

# é‡å¯æœåŠ¡
restart:
	@echo "ğŸ”„ é‡å¯PDF ValidatoræœåŠ¡..."
	docker-compose restart
	@echo "âœ… æœåŠ¡å·²é‡å¯"

# æŸ¥çœ‹æ—¥å¿—
logs:
	docker-compose logs -f --tail=100

# æ„å»ºé•œåƒ
build:
	@echo "ğŸ”¨ æ„å»ºPDF Validatoré•œåƒ..."
	docker-compose build --no-cache
	@echo "âœ… é•œåƒæ„å»ºå®Œæˆ"

# æ¸…ç†
clean:
	@echo "ğŸ§¹ æ¸…ç†PDF ValidatoræœåŠ¡..."
	docker-compose down -v
	@echo "âœ… æ¸…ç†å®Œæˆ"

# æœåŠ¡çŠ¶æ€
status:
	@echo "ğŸ“Š PDF ValidatoræœåŠ¡çŠ¶æ€:"
	@docker-compose ps

# APIæ—¥å¿—
api-logs:
	docker-compose logs -f pdf-validator-api --tail=100

# Workeræ—¥å¿—
worker-logs:
	docker-compose logs -f pdf-validator-worker --tail=100

# æ‰“å¼€Flower
flower:
	@echo "ğŸŒ¸ æ‰“å¼€Flowerç›‘æ§ç•Œé¢..."
	@open http://localhost:5555 || xdg-open http://localhost:5555

# æµ‹è¯•API
test:
	@echo "ğŸ§ª æµ‹è¯•PDF Validator API..."
	@curl -s http://localhost:8001/health | jq . || echo "âŒ APIæœªå“åº”"

# åˆå§‹åŒ–æ•°æ®åº“
init-db:
	@echo "ğŸ—„ï¸ åˆå§‹åŒ–æ•°æ®åº“..."
	docker-compose exec postgres psql -U postgres -d moonshot -c "SELECT 1;"
	@echo "âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ"